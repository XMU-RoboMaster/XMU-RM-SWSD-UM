<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="ASR-Crash" />
      <link rel="shortcut icon" href="../favicon.ico" />
    <title>USART - 厦门大学·RoboMaster·软件标准化</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "USART";
        var mkdocs_page_input_path = "USART-Use.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 厦门大学·RoboMaster·软件标准化
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Overview</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Introduction/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Hardware-Support/">Hardware Support</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Basic</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../TIM-Use/">TIM</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">USART</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#usarth">usart.h</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#usartcpp">usart.cpp</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CAN-Use/">CAN</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Controls</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Software-Install/">Software Install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Getting-Started/">Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Motor-Control/">Motor Control</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">References</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Motor-Parameters/">Motor Parameters</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">FAQs</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../How-to-Debug/">How to Debug</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">厦门大学·RoboMaster·软件标准化</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Basic &raquo;</li><li>USART</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>串口USART通信可以支持我们使用一些扩展设备，如陀螺仪、遥控器、裁判系统等等</p>
<h1 id="usarthusartcpp">usart.h和usart.cpp文件的使用</h1>
<h2 id="usarth">usart.h</h2>
<pre><code class="language-c++">#pragma once
#include &quot;stm32f4xx_hal.h&quot;
#include &quot;stm32f4xx_hal_uart.h&quot;

#define UART_MAX_LEN 100

class UART
{
    public:
    UART&amp; Init(USART_TypeDef* Instance, uint32_t BaudRate);
    UART&amp; DMATxInit(void);
    UART&amp; DMARxInit(const uint8_t *buffer = nullptr,const uint32_t size = UART_MAX_LEN);

    void DMATransmit(uint8_t* pData, uint32_t Size) const;
    void OnUARTITHandler(uint16_t Size);
    void OnDMAITHandler(void) const;
    void RxIdleItCallback(uint16_t rxSize) const;
    void UARTTransmit(uint8_t* pData, uint32_t Size);

    static void DMAClearAllFlags(DMA_HandleTypeDef *dmax)
    {
        const auto ele = reinterpret_cast&lt;uint32_t&gt;(dmax-&gt;Instance);

        (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream0) ? (DMA1-&gt;LIFCR = 0x0000003D) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream1) ? (DMA1-&gt;LIFCR = 0x00000F40) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream2) ? (DMA1-&gt;LIFCR = 0x003D0000) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream3) ? (DMA1-&gt;LIFCR = 0x0F400000) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream4) ? (DMA1-&gt;HIFCR = 0x0000003D) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream5) ? (DMA1-&gt;HIFCR = 0x00000F40) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream6) ? (DMA1-&gt;HIFCR = 0x003D0000) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA1_Stream7) ? (DMA1-&gt;HIFCR = 0x0F400000) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream0) ? (DMA2-&gt;LIFCR = 0x0000003D) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream1) ? (DMA2-&gt;LIFCR = 0x00000F40) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream2) ? (DMA2-&gt;LIFCR = 0x003D0000) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream3) ? (DMA2-&gt;LIFCR = 0x0F400000) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream4) ? (DMA2-&gt;HIFCR = 0x0000003D) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream5) ? (DMA2-&gt;HIFCR = 0x00000F40) :\
            (ele == reinterpret_cast&lt;uint32_t&gt;DMA2_Stream6) ? (DMA2-&gt;HIFCR = 0x003D0000) :\
            (DMA2-&gt;HIFCR = 0x0F400000);
    }

    UART_HandleTypeDef huart;
    uint8_t m_uartrx[UART_MAX_LEN];
};

extern UART uart1,uart2, uart4, uart6;// , uart6, uart7;
</code></pre>
<h2 id="usartcpp">usart.cpp</h2>
<pre><code class="language-c++">#include &quot;usart.h&quot;
#include &quot;RC.h&quot;
#include &quot;judgement.h&quot;

UART&amp; UART::Init(USART_TypeDef* Instance, const uint32_t BaudRate)
{
    huart.Instance = Instance;
    huart.Init.BaudRate = BaudRate;
    huart.Init.WordLength = UART_WORDLENGTH_8B;
    huart.Init.StopBits = UART_STOPBITS_1;
    huart.Init.Parity = UART_PARITY_NONE;
    huart.Init.Mode = UART_MODE_TX_RX;
    huart.Init.HwFlowCtl = UART_HWCONTROL_NONE;
    huart.Init.OverSampling = UART_OVERSAMPLING_16;
    HAL_UART_Init(&amp;huart);

    return *this;
}
UART&amp; UART::DMATxInit(void)
{
    __HAL_DMA_DISABLE(huart.hdmatx);
    huart.hdmatx-&gt;Instance-&gt;PAR = reinterpret_cast&lt;uint32_t&gt;(&amp;huart.Instance-&gt;DR);
    huart.hdmatx-&gt;Instance-&gt;M0AR = 0;
    DMAClearAllFlags(huart.hdmatx);
    //开启DMA发送中断
    __HAL_DMA_ENABLE_IT(huart.hdmatx, DMA_IT_TC);
    SET_BIT(huart.Instance-&gt;CR3, USART_CR3_DMAT);
    return *this;
}
UART&amp; UART::DMARxInit(const uint8_t *buffer, const uint32_t size)
{
    //使能串口DMA接收
    __HAL_DMA_DISABLE(huart.hdmarx);
    huart.hdmarx-&gt;Instance-&gt;PAR = reinterpret_cast&lt;uint32_t&gt;(&amp;huart.Instance-&gt;DR);//PAR is DMA stream x peripheral address register
    huart.hdmarx-&gt;Instance-&gt;NDTR = size;
    if (buffer == nullptr)buffer = m_uartrx;
    huart.hdmarx-&gt;Instance-&gt;M0AR = reinterpret_cast&lt;uint32_t&gt;(buffer);
    DMAClearAllFlags(huart.hdmarx);
    __HAL_DMA_ENABLE(huart.hdmarx);
    SET_BIT(huart.Instance-&gt;CR3, USART_CR3_DMAR);
    //开启串口空闲中断
    __HAL_UART_CLEAR_PEFLAG(&amp;huart);
    __HAL_UART_ENABLE_IT(&amp;huart, UART_IT_IDLE);
    return *this;
}
void HAL_UART_MspInit(UART_HandleTypeDef* uartHandle)
{
    GPIO_InitTypeDef GPIO_InitStruct;
    if (uartHandle-&gt;Instance == USART1)
    {
        static DMA_HandleTypeDef hdma_rx;
        static DMA_HandleTypeDef hdma_tx;
        /* USART6 clock enable */
        __HAL_RCC_USART1_CLK_ENABLE();
        __HAL_RCC_GPIOA_CLK_ENABLE();

        /**USART6 GPIO Configuration
            PG14     ------&gt; USART6_TX
            PG9     ------&gt; USART6_RX
            */
        GPIO_InitStruct.Pin = GPIO_PIN_9 | GPIO_PIN_10;
        GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
        GPIO_InitStruct.Pull = GPIO_PULLUP;
        GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
        GPIO_InitStruct.Alternate = GPIO_AF7_USART1;
        HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);

        /* USART6 DMA Init */
        __HAL_RCC_DMA2_CLK_ENABLE();
        /* USART6_RX Init */
        hdma_rx.Instance = DMA2_Stream2;
        hdma_rx.Init.Channel = DMA_CHANNEL_4;
        hdma_rx.Init.Direction = DMA_PERIPH_TO_MEMORY;
        hdma_rx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_rx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_rx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_rx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_rx.Init.Mode = DMA_NORMAL;
        hdma_rx.Init.Priority = DMA_PRIORITY_LOW;
        hdma_rx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_rx);

        __HAL_LINKDMA(uartHandle, hdmarx, hdma_rx);

        /* USART6_TX Init */
        hdma_tx.Instance = DMA2_Stream7;
        hdma_tx.Init.Channel = DMA_CHANNEL_4;
        hdma_tx.Init.Direction = DMA_MEMORY_TO_PERIPH;
        hdma_tx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_tx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_tx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_tx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_tx.Init.Mode = DMA_NORMAL;
        hdma_tx.Init.Priority = DMA_PRIORITY_LOW;
        hdma_tx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_tx);

        __HAL_LINKDMA(uartHandle, hdmatx, hdma_tx);

        /* USART6 interrupt Init */
        HAL_NVIC_SetPriority(USART1_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(USART1_IRQn);

        /* DMA interrupt init */
        /* DMA2_Stream1_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA2_Stream2_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA2_Stream2_IRQn);
        /* DMA2_Stream6_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA2_Stream7_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA2_Stream7_IRQn);
    }
    if (uartHandle-&gt;Instance == USART2)
    {
        static DMA_HandleTypeDef hdma_rx;
        static DMA_HandleTypeDef hdma_tx;
        /* USART6 clock enable */
        __HAL_RCC_USART2_CLK_ENABLE();
        __HAL_RCC_GPIOA_CLK_ENABLE();

        /**USART6 GPIO Configuration
            PG14     ------&gt; USART6_TX
            PG9     ------&gt; USART6_RX
            */
        GPIO_InitStruct.Pin = GPIO_PIN_2 | GPIO_PIN_3;
        GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
        GPIO_InitStruct.Pull = GPIO_PULLUP;
        GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
        GPIO_InitStruct.Alternate = GPIO_AF7_USART2;
        HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);

        /* USART6 DMA Init */
        __HAL_RCC_DMA1_CLK_ENABLE();
        /* USART6_RX Init */
        hdma_rx.Instance = DMA1_Stream5;
        hdma_rx.Init.Channel = DMA_CHANNEL_4;
        hdma_rx.Init.Direction = DMA_PERIPH_TO_MEMORY;
        hdma_rx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_rx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_rx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_rx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_rx.Init.Mode = DMA_NORMAL;
        hdma_rx.Init.Priority = DMA_PRIORITY_LOW;
        hdma_rx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_rx);

        __HAL_LINKDMA(uartHandle, hdmarx, hdma_rx);

        /* USART6_TX Init */
        hdma_tx.Instance = DMA1_Stream6;
        hdma_tx.Init.Channel = DMA_CHANNEL_4;
        hdma_tx.Init.Direction = DMA_MEMORY_TO_PERIPH;
        hdma_tx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_tx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_tx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_tx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_tx.Init.Mode = DMA_NORMAL;
        hdma_tx.Init.Priority = DMA_PRIORITY_LOW;
        hdma_tx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_tx);

        __HAL_LINKDMA(uartHandle, hdmatx, hdma_tx);

        /* USART6 interrupt Init */
        HAL_NVIC_SetPriority(USART2_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(USART2_IRQn);

        /* DMA interrupt init */
        /* DMA2_Stream1_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA1_Stream5_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA1_Stream5_IRQn);
        /* DMA2_Stream6_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA1_Stream6_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA1_Stream6_IRQn);
    }
    if (uartHandle-&gt;Instance == UART4)
    {
        static DMA_HandleTypeDef hdma_rx;
        static DMA_HandleTypeDef hdma_tx;
        /* USART1 clock enable */
        __HAL_RCC_UART4_CLK_ENABLE();
        __HAL_RCC_GPIOA_CLK_ENABLE();

        /**USART1 GPIO Configuration
            PA0     ------&gt; UART4_TX
            PA1     ------&gt; UART4_RX
            */
        GPIO_InitStruct.Pin = GPIO_PIN_0 | GPIO_PIN_1;
        GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
        GPIO_InitStruct.Pull = GPIO_PULLUP;
        GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
        GPIO_InitStruct.Alternate = GPIO_AF8_UART4;
        HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);

        /* USART1 DMA Init */
        __HAL_RCC_DMA1_CLK_ENABLE();
        /* USART1_RX Init */
        hdma_rx.Instance = DMA1_Stream2;
        hdma_rx.Init.Channel = DMA_CHANNEL_4;
        hdma_rx.Init.Direction = DMA_PERIPH_TO_MEMORY;
        hdma_rx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_rx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_rx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_rx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_rx.Init.Mode = DMA_NORMAL;
        hdma_rx.Init.Priority = DMA_PRIORITY_VERY_HIGH;
        hdma_rx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_rx);

        __HAL_LINKDMA(uartHandle, hdmarx, hdma_rx);
        /* USART1_TX Init */
        hdma_tx.Instance = DMA1_Stream4;
        hdma_tx.Init.Channel = DMA_CHANNEL_4;
        hdma_tx.Init.Direction = DMA_MEMORY_TO_PERIPH;
        hdma_tx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_tx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_tx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_tx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_tx.Init.Mode = DMA_NORMAL;
        hdma_tx.Init.Priority = DMA_PRIORITY_VERY_HIGH;
        hdma_tx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_tx);
        __HAL_LINKDMA(uartHandle, hdmatx, hdma_tx);

        /* USART1 interrupt Init */
        HAL_NVIC_SetPriority(UART4_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(UART4_IRQn);

        /* DMA interrupt init */
        /* DMA2_Stream2_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA1_Stream2_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA1_Stream2_IRQn);
        /* DMA2_Stream7_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA1_Stream4_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA1_Stream4_IRQn);
    }
    if (uartHandle-&gt;Instance == USART6)
    {
        static DMA_HandleTypeDef hdma_rx;
        static DMA_HandleTypeDef hdma_tx;
        /* USART1 clock enable */
        __HAL_RCC_USART6_CLK_ENABLE();
        __HAL_RCC_GPIOC_CLK_ENABLE();

        /**USART1 GPIO Configuration
            PC6     ------&gt; USART6_TX
            PC7     ------&gt; USART6_RX
            */
        GPIO_InitStruct.Pin = GPIO_PIN_6 | GPIO_PIN_7;
        GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;
        GPIO_InitStruct.Pull = GPIO_PULLUP;
        GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
        GPIO_InitStruct.Alternate = GPIO_AF8_USART6;
        HAL_GPIO_Init(GPIOC, &amp;GPIO_InitStruct);

        /* USART6 DMA Init */
        __HAL_RCC_DMA2_CLK_ENABLE();
        /* USART6_RX Init */
        hdma_rx.Instance = DMA2_Stream1;
        hdma_rx.Init.Channel = DMA_CHANNEL_5;
        hdma_rx.Init.Direction = DMA_PERIPH_TO_MEMORY;
        hdma_rx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_rx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_rx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_rx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_rx.Init.Mode = DMA_NORMAL;
        hdma_rx.Init.Priority = DMA_PRIORITY_LOW;
        hdma_rx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_rx);

        __HAL_LINKDMA(uartHandle, hdmarx, hdma_rx);
        /* USART6_TX Init */
        hdma_tx.Instance = DMA2_Stream6;
        hdma_tx.Init.Channel = DMA_CHANNEL_5;
        hdma_tx.Init.Direction = DMA_MEMORY_TO_PERIPH;
        hdma_tx.Init.PeriphInc = DMA_PINC_DISABLE;
        hdma_tx.Init.MemInc = DMA_MINC_ENABLE;
        hdma_tx.Init.PeriphDataAlignment = DMA_PDATAALIGN_BYTE;
        hdma_tx.Init.MemDataAlignment = DMA_MDATAALIGN_BYTE;
        hdma_tx.Init.Mode = DMA_NORMAL;
        hdma_tx.Init.Priority = DMA_PRIORITY_LOW;
        hdma_tx.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
        HAL_DMA_Init(&amp;hdma_tx);
        __HAL_LINKDMA(uartHandle, hdmatx, hdma_tx);

        /* USART1 interrupt Init */
        HAL_NVIC_SetPriority(USART6_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(USART6_IRQn);

        /* DMA interrupt init */
        /* DMA2_Stream2_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA2_Stream1_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA2_Stream1_IRQn);
        /* DMA2_Stream7_IRQn interrupt configuration */
        HAL_NVIC_SetPriority(DMA2_Stream6_IRQn, 0, 0);
        HAL_NVIC_EnableIRQ(DMA2_Stream6_IRQn);
    }
}

void UART::RxIdleItCallback(const uint16_t rxSize) const
{
    if (huart.Instance == USART1)
    {

        if (nuc.rxData[0] == 'w'&amp;&amp;nuc.rxData[1] == 'h'&amp;&amp;nuc.rxData[2] == 'i'&amp;&amp;nuc.rxData[3] == 'c'&amp;&amp;nuc.rxData[4] == 'h')
        {
            if (judgement.ready == true)
            {
                uint8_t red[2] = &quot;R&quot;;
                uint8_t blue[2] = &quot;B&quot;;
                if (judgement.data.ext_game_robot_status_t.robot_id &lt; 10)
                {
                    uart1.UARTTransmit(red, 1);
                }
                else
                {
                    uart1.UARTTransmit(blue, 1);
                }
            }
        }
        else

            nuc.OnIRQHandler(rxSize);
    }
    if (huart.Instance == USART2)
    {
        rc.OnIRQHandler(rxSize);
    }
    if (huart.Instance == UART4)
    {
        imu.OnIRQHandler(rxSize);
    }
    if (huart.Instance == USART6)
    {
        judgement.OnIRQHandler(rxSize);
    }
}
void UART::OnUARTITHandler(const uint16_t Size = UART_MAX_LEN)
{
    if (__HAL_UART_GET_FLAG(&amp;huart, UART_FLAG_IDLE) &amp;&amp; __HAL_UART_GET_IT_SOURCE(&amp;huart, UART_IT_IDLE))
    {
        __HAL_UART_CLEAR_IDLEFLAG(&amp;huart);
        __HAL_DMA_DISABLE(huart.hdmarx);

        DMAClearAllFlags(huart.hdmarx);
        RxIdleItCallback(Size - __HAL_DMA_GET_COUNTER(huart.hdmarx));

        __HAL_DMA_SET_COUNTER(huart.hdmarx, Size);
        __HAL_DMA_ENABLE(huart.hdmarx);
    }
    HAL_UART_IRQHandler(&amp;huart);
}
void UART::OnDMAITHandler(void) const
{
    UART::DMAClearAllFlags(huart.hdmatx);
    __HAL_DMA_DISABLE(huart.hdmatx);
}


extern &quot;C&quot; void USART1_IRQHandler(void)
{
    uart1.OnUARTITHandler();
}
extern &quot;C&quot; void USART2_IRQHandler(void)
{
    uart2.OnUARTITHandler();
}
//extern &quot;C&quot; void USART6_IRQHandler(void)
//{
//  uart6.OnUARTITHandler();
//}
extern &quot;C&quot; void UART4_IRQHandler(void)
{
    uart4.OnUARTITHandler();
}

extern &quot;C&quot; void USART6_IRQHandler(void)//Question
{
    uart6.OnUARTITHandler();
}

extern &quot;C&quot; void DMA1_Stream2_IRQHandler(void)
{
}
extern &quot;C&quot; void DMA1_Stream4_IRQHandler(void)
{
    uart4.OnDMAITHandler();
}

extern &quot;C&quot; void DMA2_Stream6_IRQHandler(void)
{
    uart6.OnDMAITHandler();
}

void UART::DMATransmit(uint8_t*const pData, const uint32_t Size) const
{
    __HAL_DMA_DISABLE(huart.hdmatx);
    huart.hdmatx-&gt;Instance-&gt;NDTR = Size;
    huart.hdmatx-&gt;Instance-&gt;M0AR = reinterpret_cast&lt;uint32_t&gt;(pData);
    DMAClearAllFlags(huart.hdmatx);
    __HAL_DMA_ENABLE(huart.hdmatx);
}
void UART::UARTTransmit(uint8_t* pData, uint32_t Size)
{
    HAL_UART_Transmit(&amp;huart, static_cast&lt;uint8_t*&gt;(pData), Size, 0xffff);
}

extern &quot;C&quot; void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
}

</code></pre>
<p>将我们的项目文件添加如上两个文件，文件中包括USART通信的收发方式，可以更方便我们使用USART通信来进行扩展模块代码的编写。</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../TIM-Use/" class="btn btn-neutral float-left" title="TIM"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../CAN-Use/" class="btn btn-neutral float-right" title="CAN">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright © 2022 ASR-Crash, XMU-RCS</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../TIM-Use/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../CAN-Use/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
